<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
<meta name="google-site-verification" content="BwgqiIzQchPDR7zX1LTz3rvDOEdItP0FVRQGYUdiH20" />
<meta name="baidu-site-verification" content="code-bc4Ap0GvsO" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/32.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16.png">
  <link rel="mask-icon" href="/images/32.png" color="#222">
  <link rel="manifest" href="/images/32.png">
  <meta name="msapplication-config" content="/images/32.png">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="好的，我会为你准备一个详细的 Oracle VPS 搭建 V2RayN 节点的教程，确保它可以在中国大陆稳定访问，同时结合 Cloudflare 进行加密和隐蔽。 我会包括以下步骤：  Oracle VPS 设置：基础环境安装，包括 Ubuntu 系统更新、基础软件安装。 域名解析：如何使用 Cloudflare 配置你的域名（example.com）。 Nginx 安装与配置：确保服务器可以托管">
<meta property="og:type" content="article">
<meta property="og:title" content="Oracle VPS (Ubuntu) V2RayN 节点部署教程（Cloudflare TLS+WebSocket）">
<meta property="og:url" content="http://example.com/2025/033801684960.html">
<meta property="og:site_name" content="GAIVRT">
<meta property="og:description" content="好的，我会为你准备一个详细的 Oracle VPS 搭建 V2RayN 节点的教程，确保它可以在中国大陆稳定访问，同时结合 Cloudflare 进行加密和隐蔽。 我会包括以下步骤：  Oracle VPS 设置：基础环境安装，包括 Ubuntu 系统更新、基础软件安装。 域名解析：如何使用 Cloudflare 配置你的域名（example.com）。 Nginx 安装与配置：确保服务器可以托管">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-03-15T11:09:00.000Z">
<meta property="article:modified_time" content="2025-03-16T02:04:07.402Z">
<meta property="article:author" content="GAIVR">
<meta property="article:tag" content="网络">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2025/033801684960.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Oracle VPS (Ubuntu) V2RayN 节点部署教程（Cloudflare TLS+WebSocket） | GAIVRT</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">GAIVRT</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/033801684960.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="GAIVR">
      <meta itemprop="description" content="我在恐惧的释放着自信">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GAIVRT">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Oracle VPS (Ubuntu) V2RayN 节点部署教程（Cloudflare TLS+WebSocket）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-03-15 19:09:00" itemprop="dateCreated datePublished" datetime="2025-03-15T19:09:00+08:00">2025-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-16 10:04:07" itemprop="dateModified" datetime="2025-03-16T10:04:07+08:00">2025-03-16</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2025/033801684960.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/033801684960.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>18k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>好的，我会为你准备一个详细的 Oracle VPS 搭建 V2RayN 节点的教程，确保它可以在中国大陆稳定访问，同时结合 Cloudflare 进行加密和隐蔽。</p>
<p>我会包括以下步骤：</p>
<ol>
<li><strong>Oracle VPS 设置</strong>：基础环境安装，包括 Ubuntu 系统更新、基础软件安装。</li>
<li><strong>域名解析</strong>：如何使用 Cloudflare 配置你的域名（example.com）。</li>
<li><strong>Nginx 安装与配置</strong>：确保服务器可以托管网站，同时允许 V2Ray WebSocket 运行。</li>
<li><strong>V2Ray 安装与配置</strong>：使用 WebSocket + TLS，并设置安全加密。</li>
<li><strong>TLS 证书配置</strong>：使用 Let’s Encrypt 为你的服务器启用 HTTPS。</li>
<li><strong>防火墙与安全设置</strong>：保护你的服务器免受扫描和攻击。</li>
<li><strong>V2RayN 端设置</strong>：如何在 Windows 11 电脑上使用 V2RayN 连接到 VPS。</li>
<li><strong>额外安全与混淆</strong>：如何进一步加强隐蔽性，防止被 GFW 识别。</li>
</ol>
<span id="more"></span>

<h1 id="Oracle-VPS-Ubuntu-V2RayN-节点部署教程（Cloudflare-TLS-WebSocket）"><a href="#Oracle-VPS-Ubuntu-V2RayN-节点部署教程（Cloudflare-TLS-WebSocket）" class="headerlink" title="Oracle VPS (Ubuntu) V2RayN 节点部署教程（Cloudflare TLS+WebSocket）"></a>Oracle VPS (Ubuntu) V2RayN 节点部署教程（Cloudflare TLS+WebSocket）</h1><p>本文将一步步讲解如何在 <strong>Oracle 云的 Ubuntu VPS</strong> 上部署最新版本的 V2Ray 服务端，并使用 <strong>TLS 加密 + WebSocket</strong> 协议通过 <strong>Cloudflare CDN</strong> 中转，增强在中国大陆的稳定性和隐蔽性。同时配置 Nginx 提供网站伪装，并详述防火墙安全优化措施，最后给出 Windows 11 客户端 V2RayN 的配置教程。</p>
<h2 id="1-Oracle-VPS-基础环境设置"><a href="#1-Oracle-VPS-基础环境设置" class="headerlink" title="1. Oracle VPS 基础环境设置"></a>1. Oracle VPS 基础环境设置</h2><p><strong>（1）系统更新与基础软件安装：</strong> 首先通过 SSH 登录 Oracle Ubuntu VPS，获取最新的软件包更新：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br></pre></td></tr></table></figure>

<p>升级完成后，安装所需的基础软件，例如 <strong>Nginx</strong>（用于网站和反向代理）以及 <strong>Snapd&#x2F;Certbot</strong>（用于申请 TLS 证书）。执行以下命令安装 Nginx 和 Snapd：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y nginx snapd</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>说明：</strong>Certbot 是 EFF 提供的自动化获取 Let’s Encrypt 证书的工具。Ubuntu 上推荐通过 Snap 安装[最新版本]([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=,s">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=,s</a> %2Fsnap%2Fbin%2Fcertbot %2Fusr%2Fbin%2Fcertbot))。安装 Snapd 后，可使用 <code>sudo snap install --classic certbot</code> 来安装 [Certbot]([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=sudo">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=sudo</a> apt install snapd sudo,s %2Fsnap%2Fbin%2Fcertbot %2Fusr%2Fbin%2Fcertbot))。</p>
</blockquote>
<p><strong>（2）设置主机名与时区（可选）：</strong> 为避免 TLS 证书申请时的时间偏差问题，确认系统时区正确：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo timedatectl set-timezone Asia/Shanghai  <span class="comment"># 设置时区为上海时间（根据需要调整）</span></span><br><span class="line">sudo timedatectl set-ntp <span class="literal">true</span>                <span class="comment"># 启用NTP同步</span></span><br></pre></td></tr></table></figure>

<p><strong>（3）Oracle Cloud 防火墙配置：</strong> Oracle 云默认对入站流量有安全策略限制。确保在 Oracle 云控制台为实例打开必要端口：<strong>TCP 22</strong>（SSH）、<strong>TCP 80</strong>（HTTP）、<strong>TCP 443</strong>（HTTPS）。可以在实例所在的 Virtual Cloud Network (VCN) 的“安全列表”或“网络安全组”中添加规则，将 80 和 443 端口加入允许列表（默认只开放了 22）。例如，将入站规则的目标端口设置为 “22,80,443”，保存更改后生效 ([甲骨文Oracle Cloud添加新端口开放的方法 - WirelessLink Forum](<a target="_blank" rel="noopener" href="https://forums.wirelesslink.net/forums/topic/oracle_oracle-cloud_adds_a_new_port_opening_method/#:~:text=%E5%B0%86%E2%80%9C%E7%9B%AE%E7%9A%84%E5%9C%B0%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E2%80%9D%E4%B8%8B%E7%9A%84%E2%80%9C22%E2%80%9D%E6%94%B9%E4%B8%BA%E2%80%9C22%2C80%2C443%E2%80%9D%EF%BC%8C%E7%84%B6%E5%90%8E%E2%80%9C%E4%BF%9D%E5%AD%98%E6%9B%B4%E6%94%B9%E2%80%9D%E5%8D%B3%E5%8F%AF%E3%80%82">https://forums.wirelesslink.net/forums/topic/oracle_oracle-cloud_adds_a_new_port_opening_method/#:~:text=将“目的地端口范围”下的“22”改为“22%2C80%2C443”，然后“保存更改”即可。</a> 系统会自动根据添加的IP生成新的两条规则。 注意：每个端口或范围间隔需要英文逗号；如果需要增加 ))。</p>
<p>完成上述环境准备后，VPS 基础环境配置就绪。接下来进行域名解析与 Cloudflare 设置。</p>
<h2 id="2-Cloudflare-域名解析与-DNS-配置"><a href="#2-Cloudflare-域名解析与-DNS-配置" class="headerlink" title="2. Cloudflare 域名解析与 DNS 配置"></a>2. Cloudflare 域名解析与 DNS 配置</h2><p><strong>（1）将域名添加到 Cloudflare：</strong> 确保您的域名 <strong>example.com</strong> 已在 Cloudflare 管理。在 Cloudflare Dash 面板中，添加站点并选择 <strong>Free</strong> 免费计划。按照提示将域名的 DNS 服务器修改为 Cloudflare 提供的名称服务器 (<a target="_blank" rel="noopener" href="https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=%E6%8E%A5%E4%B8%8B%E6%9D%A5Cloudflare%E4%BC%9A%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%8F%98%E6%9B%B4%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E5%B9%B6%E7%BB%99%E5%87%BA%E4%BA%86%E6%96%B9%E6%B3%95%E3%80%82">ssr&#x2F;ssr-advanced&#x2F;v2ray-ws-tls-web.md at master · fqfree&#x2F;ssr · GitHub</a>)（如果尚未如此设置）。完成后，Cloudflare 会开始托管您的域名 DNS。</p>
<p><strong>（2）设置 DNS 记录：</strong> 在 Cloudflare 控制台的 <strong>DNS</strong> 页面，为 <strong>example.com</strong> 添加一条 <strong>A记录</strong>，指向您的 Oracle VPS 公网 IP 地址。将云朵状态设为<strong>橙色云朵</strong>（表示启用 Cloudflare 代理，加速与保护）。这样解析生效后，用 <code>ping example.com</code> 得到的是 Cloudflare 的 CDN IP，而不是服务器真实 IP ([V2ray使用Cloudflare中转流量，拯救被墙的IP - HiFeng’s Blog](<a target="_blank" rel="noopener" href="https://www.hicairo.com/post/24.html#:~:text=V2ray%E4%BD%BF%E7%94%A8Cloudflare%E4%B8%AD%E8%BD%AC%E6%B5%81%E9%87%8F%EF%BC%8C%E6%8B%AF%E6%95%91%E8%A2%AB%E5%A2%99%E7%9A%84IP">https://www.hicairo.com/post/24.html#:~:text=V2ray使用Cloudflare中转流量，拯救被墙的IP</a> ,是你的服务器IP； · 在CF上添加))。</p>
<ul>
<li><strong>记录类型:</strong> A</li>
<li><strong>主机名:</strong> @（表示根域）</li>
<li><strong>IPv4 地址:</strong> <em>您的VPS公网IP</em></li>
<li><strong>代理状态:</strong> Proxied (橙色云朵)</li>
<li><strong>TTL:</strong> Auto</li>
</ul>
<p>如果希望同时支持 <code>www.example.com</code>，可再添加一条 <code>www</code> 的 A 记录指向同一 IP，并启用代理。</p>
<p><strong>（3）SSL&#x2F;TLS 加密模式：</strong> 在 Cloudflare 仪表盘，找到 <strong>SSL&#x2F;TLS</strong> 设置，将加密模式调整为 <strong>“Full (Strict)”（完全加密 严格模式）</strong> (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E9%85%8D%E7%BD%AE%E5%8A%A0%E5%AF%86%E6%A8%A1%E5%BC%8F">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)。此模式要求 Cloudflare 与源站之间必须使用有效证书通信，保证 <strong>客户端→Cloudflare→服务器</strong> 全链路都是加密的。我们稍后会为 example.com 配置有效的 Let’s Encrypt 证书来满足严格模式需求。</p>
<blockquote>
<p><strong>说明：</strong>使用 Cloudflare 代理流量，可以隐藏服务器真实 IP，降低被 GFW 直接封锁 IP 的概率 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=WebSocket%2BTLS%2BWeb%E7%9A%84%E7%BB%84%E5%90%88%E6%80%8E%E4%B9%88%E6%9D%A5%E7%9A%84%EF%BC%9F%E8%BF%99%E4%B8%AA%E7%BB%84%E5%90%88%E6%84%8F%E6%80%9D%E6%98%AF%EF%BC%8C%E5%9C%A8%E6%9C%BA%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AAweb%E7%AB%99%E7%82%B9%EF%BC%8C%E4%BD%BF%E7%94%A8">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=WebSocket%2BTLS%2BWeb的组合怎么来的？这个组合意思是，在机器上部署一个web站点，使用</a> Nginx%2FCaddy%2FApache 可以将 V2Ray 稍作隐藏。使用,只能用 WebSocket，使用 TLS 是因为可以流量加密，看起来更像 HTTPS。也就是说，我们的机器看起来是个正常的网站，当访问特定的path，可以把流量转发给V2Ray。)) (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%B8%80%E8%88%AC%E6%9D%A5%E8%AF%B4%EF%BC%8C%E8%A3%85%E5%A5%BDV2Ray%E4%B9%8B%E5%90%8E%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AFIP%E7%BB%8F%E5%B8%B8%E8%A2%AB%E5%B0%81%EF%BC%8C%E5%9B%BA%E6%9C%89%E6%AD%A4%E6%96%B9%E6%A1%88%E3%80%82">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)。即使将来出现 IP 被封等情况，也可以很快切换到 CDN 中转的方案来继续服务 ([ssr&#x2F;ssr-advanced&#x2F;v2ray-ws-tls-web.md at master · fqfree&#x2F;ssr · GitHub](<a target="_blank" rel="noopener" href="https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=%E8%BF%99%E9%87%8C%E4%BB%8E%E5%9F%9F%E5%90%8D%E6%B3%A8%E5%86%8C%E5%95%86GoDaddy%E8%B4%AD%E4%B9%B0%E5%9F%9F%E5%90%8D%EF%BC%8C%E7%94%A8Cloudflare%E6%8F%90%E4%BE%9B%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E3%80%82GoDaddy%E6%9C%AC%E8%BA%AB%E4%B9%9F%E6%8F%90%E4%BE%9B%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%BF%99%E9%87%8C%E7%94%A8Cloudflare%E6%98%AF%E4%B8%BA%E4%BA%86%E9%85%8D%E7%BD%AECDN%E6%96%B9%E4%BE%BF">https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=这里从域名注册商GoDaddy购买域名，用Cloudflare提供域名解析。GoDaddy本身也提供域名解析服务，这里用Cloudflare是为了配置CDN方便</a> 。如果遇到墙加高，或者IP被墙等极端情况，只要简单的配置就可以切换成v2ray%2Bws%2Btls%2Bweb%2Bcdn。CDN翻墙速度较慢，但是稳定性极高。))。</p>
</blockquote>
<p>完成域名解析配置后，可在浏览器中访问 <code>http://example.com</code>（尚未配置 HTTPS），预期会暂时看到 Nginx 默认页面或无法连接（因为我们还未配置站点）。下一步将搭建网站和配置 Nginx。</p>
<h2 id="3-安装-Nginx-并配置网站虚拟主机"><a href="#3-安装-Nginx-并配置网站虚拟主机" class="headerlink" title="3. 安装 Nginx 并配置网站虚拟主机"></a>3. 安装 Nginx 并配置网站虚拟主机</h2><p><strong>（1）创建站点目录和测试页面：</strong> 准备一个用来伪装的网站目录。在服务器上执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /var/www/example.com</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hello, V2Ray!&quot;</span> | sudo <span class="built_in">tee</span> /var/www/example.com/index.html</span><br></pre></td></tr></table></figure>

<p>以上命令将在 <code>/var/www/example.com</code> 下创建一个简单的 <code>index.html</code> 测试主页。您可以将此文件替换为更真实的静态网页内容，例如放置一个个人博客的静态页面，以增强迷惑性。</p>
<p><strong>（2）配置 Nginx 虚拟主机：</strong> 编辑 Nginx 配置文件，新建一个虚拟主机来服务您的域名。执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/nginx/sites-available/example.com</span><br></pre></td></tr></table></figure>

<p>在编辑器中填入以下配置（将 <code>example.com</code> 替换为您的域名）：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;  <span class="comment"># 监听 80 端口（HTTP）</span></span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line">    <span class="attribute">root</span> /var/www/example.com;</span><br><span class="line">    <span class="attribute">index</span> index.html;</span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>配置说明：</strong>上述配置定义了一个监听80端口的虚拟主机，主机名为您的域名，网站根目录指向我们刚才创建的静态文件夹，并使用 <code>try_files</code> 确保只有存在的文件才会被访问，否则返回404 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=server">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=server</a> { listen 80%3B ,虚拟主机名))。</p>
</blockquote>
<p>保存并退出编辑器。接着启用该站点配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/example.com</span><br><span class="line">sudo <span class="built_in">rm</span> /etc/nginx/sites-enabled/default    <span class="comment"># 删除默认站点（可选）</span></span><br></pre></td></tr></table></figure>

<p><strong>（3）启动 Nginx 并测试：</strong> 重启 Nginx 使配置生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>

<p>确保防火墙已允许80端口（若之前未开启，在 Oracle 控制台和 UFW 中都要放行 TCP 80）。然后在本地浏览器访问 **<code>http://example.com</code>**，应看到我们设置的 “Hello, V2Ray!” 文本。若无法访问，请检查域名解析是否生效，以及服务器防火墙&#x2F;UFW是否已允许80端口流量 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E7%99%BB%E5%BD%95%E9%98%BF%E9%87%8C%E4%BA%91%E6%8E%A7%E5%88%B6%E5%8F%B0%EF%BC%8C%E8%BF%9B%E5%85%A5%E5%9F%9F%E5%90%8D%E5%88%97%E8%A1%A8%EF%BC%8C%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9F%9F%E5%90%8D%E8%AE%BE%E7%BD%AE%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95%EF%BC%9A%E6%B7%BB%E5%8A%A0%E4%B8%80%E6%9D%A1A%E8%AE%B0%E5%BD%95%EF%BC%8C%E8%AE%A9%E8%AF%A5%E5%9F%9F%E5%90%8D%E6%8C%87%E5%90%91%E4%BD%A0%E7%9A%84VPS%E6%9C%BA%E5%99%A8%E7%9A%84ip%E3%80%82%E7%84%B6%E5%90%8E%E9%AA%8C%E8%AF%81%E8%83%BD%E5%90%A6%E9%80%9A%E8%BF%87%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE%E8%87%AA%E5%B7%B1%E7%9A%84web%E7%AB%99%E7%82%B9%E3%80%82%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BE%93">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=登录阿里云控制台，进入域名列表，为自己的域名设置解析记录：添加一条A记录，让该域名指向你的VPS机器的ip。然后验证能否通过域名访问自己的web站点。在浏览器输</a> 入 ))。至此，一个基础网站已经在运行，为下一步的 TLS 证书申请打好基础。</p>
<h2 id="4-安装-V2Ray-并配置-WebSocket-TLS-支持"><a href="#4-安装-V2Ray-并配置-WebSocket-TLS-支持" class="headerlink" title="4. 安装 V2Ray 并配置 WebSocket + TLS 支持"></a>4. 安装 V2Ray 并配置 WebSocket + TLS 支持</h2><p>接下来安装 <strong>V2Ray</strong> 服务端并配置使其通过 <strong>WebSocket + TLS</strong> 接收流量。</p>
<p><strong>（1）通过脚本安装最新 V2Ray:</strong> V2Ray 提供官方安装脚本，可一键安装最新版本（v2fly 项目提供）。在服务器上执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bash &lt;(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)</span><br></pre></td></tr></table></figure>

<p>该脚本会自动下载并安装 V2Ray 核心程序到 <code>/usr/local/bin/v2ray</code>，并将配置文件模板放置在 <code>/usr/local/etc/v2ray/config.json</code> (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=1">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)。安装完成后，V2Ray 将以 <code>v2ray</code> 系统服务的形式运行。</p>
<p><strong>（2）配置 V2Ray 服务端：</strong> 用编辑器打开 V2Ray 的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /usr/local/etc/v2ray/config.json</span><br></pre></td></tr></table></figure>

<p>将默认配置修改为如下内容，并使用实际信息替换相应字段：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;inbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span>              <span class="comment">// 本地监听端口（随意设置一个未占用端口）</span></span><br><span class="line">      <span class="attr">&quot;listen&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1&quot;</span><span class="punctuation">,</span>      <span class="comment">// 只监听本地回环地址，防止外部直接访问</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vmess&quot;</span><span class="punctuation">,</span>        <span class="comment">// 传入协议：VMess</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;clients&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;</span><span class="punctuation">,</span>  <span class="comment">// 用户ID(UUID)</span></span><br><span class="line">            <span class="attr">&quot;alterId&quot;</span><span class="punctuation">:</span> <span class="number">0</span>            <span class="comment">// 辅助ID，V2Ray4+版本建议设为0 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%7B%20%22id%22%3A%20%22faef4e76,0%20%2F%2F%20%E6%96%B0%E7%89%88%E6%9C%AC%E4%B8%8D%E8%83%BD%E8%AE%BE%E7%BD%AE%E4%B8%BA64)) ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=,0%20%2F%2F%20%E6%96%B0%E7%89%88%E6%9C%AC%E4%B8%8D%E8%83%BD%E8%AE%BE%E7%BD%AE%E4%B8%BA64))</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;streamSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;network&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ws&quot;</span><span class="punctuation">,</span>           <span class="comment">// 传输层使用 WebSocket</span></span><br><span class="line">        <span class="attr">&quot;wsSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/ray&quot;</span>           <span class="comment">// WebSocket 路径，与 Nginx 配置保持一致</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;outbounds&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;freedom&quot;</span><span class="punctuation">,</span>      <span class="comment">// 传出协议：freedom（直接连接目标网站）</span></span><br><span class="line">      <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>请注意：</p>
<ul>
<li><strong>UUID：</strong>上方 <code>&quot;id&quot;</code> 字段的值应为一个全新的 UUID，这是您的 VMess 用户ID，类似于密码。可通过命令 <code>uuidgen</code> 生成，或在线生成 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%B8%8A%E9%9D%A2%E7%9A%84%E7%94%A8%E6%88%B7ID%E6%98%AFUUID%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%90%86%E8%A7%A3%E4%B8%BA%E5%AF%86%E7%A0%81%EF%BC%8C%E8%AF%B7%E4%BF%AE%E6%94%B9%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%9A%84%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8%E7%BA%BF%E7%94%9F%E6%88%90%EF%BC%9AOnline">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=上面的用户ID是UUID，可以理解为密码，请修改为自己的，这里可以在线生成：Online</a> UUID Generator Tool))。填写后请妥善保存，客户端连接需要使用相同的 UUID。</li>
<li><strong>alterId：</strong>由于 VMess 协议新版本已弃用非0的 alterId，这里设为0即可 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text={">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text={</a> “id”%3A “faef4e76,0 %2F%2F 新版本不能设置为64))。客户端配置也需一致。</li>
<li><strong>端口 (port)：</strong>这里我们使用 10000 作为 V2Ray 本地监听端口。这是任意的未占用端口，<strong>不需要对外开放</strong>，因为流量将通过 Nginx 的反向代理内部转发到这个端口。</li>
<li><strong>WebSocket 路径 (path)：</strong>设置为 <code>/ray</code>（可自定义为任意路径）。建议选择一个常见但不明显的路径，如 <code>/login</code>、<code>/api</code> 等，使其看起来像正常网页请求的一部分 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=location">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=location</a> %2Flogin { ,proxy_set_header Host %24host)) (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%B8%8A%E8%BF%B0%E9%85%8D%E7%BD%AE%E7%9A%84%E6%84%8F%E6%80%9D%E6%98%AF%EF%BC%8C%E5%BD%93%E8%AE%BF%E9%97%AE">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)。Nginx 将只把这个特定路径的请求转发给 V2Ray。<strong>注意</strong>：Nginx 和 V2Ray 的配置中此路径必须一致。</li>
</ul>
<p>配置完成后保存文件。然后重启 V2Ray 服务使配置生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart v2ray</span><br></pre></td></tr></table></figure>

<p>此时 V2Ray 服务端已在本机 127.0.0.1:10000 上等待 WebSocket 连接，但还没有真正接收到外部请求。接下来我们需要配置 Nginx 将特定请求转发给 V2Ray。</p>
<p><strong>（3）配置 Nginx 反向代理 V2Ray 流量：</strong> 打开我们之前创建的 Nginx 配置 <code>/etc/nginx/sites-available/example.com</code>，在 <strong>监听443端口的 server 区块</strong>（我们稍后会配置 TLS，因此443的配置将在获取证书后生成）中加入一个 <code>location</code> 段落，用于匹配 WebSocket 路径并反代到 V2Ray：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /ray &#123;  <span class="comment"># 与 V2Ray 配置中的 path 保持一致</span></span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$http_upgrade</span> != <span class="string">&quot;websocket&quot;</span>) &#123; </span><br><span class="line">        <span class="attribute">return</span> <span class="number">404</span>;  <span class="comment"># 非WebSocket请求返回404以隐藏服务</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">proxy_pass</span>       http://127.0.0.1:10000;  <span class="comment"># 转发请求到V2Ray本地端口</span></span><br><span class="line">    <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>  Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>  Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>  Host <span class="variable">$host</span>;</span><br><span class="line">    <span class="comment"># 以下头部让 V2Ray 获取真实客户端IP (可选)</span></span><br><span class="line">    <span class="attribute">proxy_set_header</span>  X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span>  X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述配置的含义是：当访问 <code>https://example.com/ray</code> 时（假设后面设置了443端口），Nginx 将把请求升级为 WebSocket 并转发给本机端口10000的服务 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=location">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=location</a> %2Flogin { ,proxy_set_header Host %24host)) (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%B8%8A%E8%BF%B0%E9%85%8D%E7%BD%AE%E7%9A%84%E6%84%8F%E6%80%9D%E6%98%AF%EF%BC%8C%E5%BD%93%E8%AE%BF%E9%97%AE">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)。如果有客户端以普通HTTP方式访问 <code>/ray</code>，由于未包含 WebSocket 的 Upgrade 头，则会匹配 if 条件返回404，从而隐藏真实服务。</p>
<blockquote>
<p><strong>提示：</strong>上例中 <code>/ray</code> 只是示例路径。您可以换成更隐蔽的路径（如 <code>/login</code> (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)），但需要同步修改 V2Ray 服务端和客户端的配置。选择一个常见词汇可以让流量看起来更正常，不过由于 TLS 已经加密请求URL，外界无法直接看到具体路径，但一个合乎常理的路径在日志和访问分析时也不显突兀。</p>
</blockquote>
<p>配置添加后，先不用重启 Nginx（因为我们还未配置443虚拟主机）。下一步，我们将为域名申请 TLS 证书，并让 Nginx 支持 HTTPS。</p>
<h2 id="5-申请并配置-TLS-证书-Let’s-Encrypt"><a href="#5-申请并配置-TLS-证书-Let’s-Encrypt" class="headerlink" title="5. 申请并配置 TLS 证书 (Let’s Encrypt)"></a>5. 申请并配置 TLS 证书 (Let’s Encrypt)</h2><p>为了支持 TLS 加密，我们使用 <strong>Let’s Encrypt</strong> 免费证书。这里使用 Certbot 工具自动申请和配置证书。</p>
<p><strong>（1）安装 Certbot：</strong> 如果前面通过 Snap 安装了 Certbot，可跳过此步。如果未安装，执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo snap install --classic certbot</span><br><span class="line">sudo <span class="built_in">ln</span> -s /snap/bin/certbot /usr/bin/certbot  <span class="comment"># 链接到可执行路径</span></span><br></pre></td></tr></table></figure>

<p>或者使用 apt 安装（Ubuntu 20.04+ 包含 certbot）：<code>sudo apt install certbot python3-certbot-nginx</code>.</p>
<p><strong>（2）使用 Certbot 获取证书：</strong> 运行交互式命令让 Certbot 自动为 Nginx 配置证书：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx -d example.com</span><br></pre></td></tr></table></figure>

<p>首次运行会提示输入注册邮箱、同意服务条款等。然后 Certbot 会自动进行域名所有权验证（通过临时文件访问 <code>http://example.com/.well-known/...</code>，因此确保80端口正常）。验证通过后，它将颁发证书并询问是否将 HTTP 流量重定向到 HTTPS。选择 <strong>Redirect</strong>（重定向），Certbot 将自动在 Nginx 配置中添加443端口的 server 区块和重定向配置 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=server">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=server</a> ,managed by Certbot)) ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E5%8F%AF%E8%A7%81%EF%BC%8C%E4%BB%A5">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=可见，以</a> ,。))。</p>
<p>完成后，Certbot 会输出证书的保存路径，并已将其配置进 Nginx。例如，在 <code>/etc/nginx/sites-enabled/example.com</code> 中可以看到类似：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;              <span class="comment"># HTTPS监听</span></span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line">    <span class="attribute">ssl_certificate</span> /etc/letsencrypt/live/example.com/fullchain.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /etc/letsencrypt/live/example.com/privkey.pem;</span><br><span class="line">    ...</span><br><span class="line">    <span class="section">location</span> / &#123; ... &#125;           <span class="comment"># 保持之前的静态站点配置</span></span><br><span class="line">    <span class="section">location</span> /ray &#123; ... &#125;        <span class="comment"># 我们添加的WebSocket转发配置</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">if</span> (<span class="variable">$host</span> = example.com) &#123;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line">    <span class="attribute">return</span> <span class="number">404</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Certbot 自动做了两件事：<strong>一是在原有server段落中加入SSL证书配置，使其监听443端口 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=listen">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=listen</a> 443 ssl%3B ,server))；二是新增一个监听80的server段将所有请求重定向到HTTPS ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=if">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=if</a> (%24host %3D mydomain.com) ,managed by Certbot))。</strong></p>
<p>现在重启 Nginx 服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure>

<p>此时访问 <strong><code>https://example.com</code></strong> 应该可以看到浏览器地址栏的安全锁，并正常显示伪装网站内容（如我们的“Hello, V2Ray!”）。</p>
<p>验证 <code>https://example.com/ray</code> 路径：在浏览器直接访问该路径会返回404（因为没有Upgrade头，被Nginx拦截），这是正常的，表明只有符合协议的 WebSocket 客户端才能利用该地址。</p>
<p>Certbot 已默认配置自动续签证书（通过 systemd timer 或 cron）。也可以手动运行 <code>sudo certbot renew --dry-run</code> 测试续签。确保80端口在未来续签时保持开启。</p>
<h2 id="6-优化防火墙与服务器安全"><a href="#6-优化防火墙与服务器安全" class="headerlink" title="6. 优化防火墙与服务器安全"></a>6. 优化防火墙与服务器安全</h2><p>安装和配置好 V2Ray + Nginx + TLS 后，我们还需进行安全优化，尽量防止被 GFW 探测和封锁，同时保障服务器不被恶意攻击。</p>
<p><strong>（1）设置 UFW 防火墙规则：</strong> Ubuntu 可以使用 <strong>UFW</strong>（Uncomplicated Firewall）来简化防火墙配置。如果之前未安装 UFW，可执行 <code>sudo apt install ufw</code>。然后按照以下步骤配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow OpenSSH        <span class="comment"># 确保SSH端口开放（默认22，如果更改请用实际端口号）</span></span><br><span class="line">sudo ufw allow http           <span class="comment"># 允许80端口（HTTP）</span></span><br><span class="line">sudo ufw allow https          <span class="comment"># 允许443端口（HTTPS）</span></span><br><span class="line">sudo ufw <span class="built_in">enable</span>               <span class="comment"># 启用防火墙（默认其他端口将被拒绝）</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>上述命令将仅开放 SSH、HTTP、HTTPS 三个常用端口，保证代理服务对外只暴露在这三个端口上，降低被探测的风险 (<a target="_blank" rel="noopener" href="https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=%E5%8F%AF%E9%80%89%E9%85%8D%E7%BD%AE2%EF%BC%9A%E5%8A%A0%E5%9B%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E9%85%8D%E7%BD%AE%E9%98%B2%E7%81%AB%E5%A2%99">ssr&#x2F;ssr-advanced&#x2F;v2ray-ws-tls-web.md at master · fqfree&#x2F;ssr · GitHub</a>) (<a target="_blank" rel="noopener" href="https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=%E5%A6%82%E6%9E%9CVPS%E4%B8%8A%E6%B2%A1%E6%9C%89%E5%85%B6%E5%AE%83%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%BB%BA%E8%AE%AE%E6%89%93%E5%BC%80%E9%98%B2%E7%81%AB%E5%A2%99%E3%80%82%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%B9%E5%A4%96%E5%8F%AA%E6%9A%B4%E9%9C%B280%EF%BC%8C443%EF%BC%8CSSH%E7%AB%AF%E5%8F%A3%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%99%8D%E4%BD%8E%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E6%8E%A2%E6%B5%8B%E7%9A%84%E9%A3%8E%E9%99%A9%E3%80%82">ssr&#x2F;ssr-advanced&#x2F;v2ray-ws-tls-web.md at master · fqfree&#x2F;ssr · GitHub</a>)。如果 SSH 使用了非22端口，请使用实际端口号替代。例如 <code>ufw allow 14320</code> ([ssr&#x2F;ssr-advanced&#x2F;v2ray-ws-tls-web.md at master · fqfree&#x2F;ssr · GitHub](<a target="_blank" rel="noopener" href="https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=,allow">https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=,allow</a> https %26%26 ufw enable))。</p>
</blockquote>
<p>由于我们的 V2Ray inbound 已设置监听在 127.0.0.1 且通过 Nginx 转发，<strong>V2Ray 所使用的内部端口（如10000）无须开放给外网</strong>，防火墙默认会阻止对其的直接访问。这进一步增加了安全性，外部扫描看不到该端口开放。</p>
<p><strong>（2）阻止异常连接和主动探测：</strong> GFW 常通过主动探测来识别翻墙服务，即伪装成客户端直接连接服务器的IP和端口，尝试协议握手。如果我们只希望通过 Cloudflare 来访问本站点，可以考虑<strong>仅允许 Cloudflare 的IP</strong>访问我们的 Web 端口，这样其他来源的直接连接都会被拒绝。实现方法包括：在防火墙添加规则，允许 Cloudflare IP 段的流量进443&#x2F;80端口，其他全部拒绝；或者在 Nginx 配置中使用 <code>allow &lt;Cloudflare_IP&gt;; deny all;</code>。</p>
<p>Cloudflare 官方提供了 IPv4&#x2F;IPv6 地址段列表 ([Allow Cloudflare IP addresses](<a target="_blank" rel="noopener" href="https://developers.cloudflare.com/fundamentals/concepts/cloudflare-ip-addresses/#:~:text=Allow">https://developers.cloudflare.com/fundamentals/concepts/cloudflare-ip-addresses/#:~:text=Allow</a> Cloudflare IP addresses To,You can))。这些地址段可能会更新，建议使用脚本定期更新防火墙规则 ([Script to update UFW with Cloudflare IPs - GitHub](<a target="_blank" rel="noopener" href="https://github.com/Paul-Reed/cloudflare-ufw#:~:text=Script">https://github.com/Paul-Reed/cloudflare-ufw#:~:text=Script</a> to update UFW with,install them into ufw’s configuration))。需要注意的是，一旦只允许 Cloudflare IP，直接通过服务器IP访问网站将失败，日常必须通过 <strong>example.com</strong> 域名（经 Cloudflare 代理）访问，这基本没影响，因为我们本就如此设计。此措施可以极大程度上缓解被主动探测识别的风险。</p>
<p><strong>（3）其他安全优化：</strong></p>
<ul>
<li><strong>隐藏服务特征：</strong> 保持 V2Ray 的 WebSocket 路径及网站内容的迷惑性。不要使用默认的 <code>/v2ray</code>、<code>/websocket</code> 等路径名，避免简单特征被识别。我们已经将路径伪装成正常网页路径（如 <code>/ray</code> 或 <code>/login</code>）。而且 WebSocket 流量本身在 TLS 加密下，看起来和普通 HTTPS 没区别 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=WebSocket%2BTLS%2BWeb%E7%9A%84%E7%BB%84%E5%90%88%E6%80%8E%E4%B9%88%E6%9D%A5%E7%9A%84%EF%BC%9F%E8%BF%99%E4%B8%AA%E7%BB%84%E5%90%88%E6%84%8F%E6%80%9D%E6%98%AF%EF%BC%8C%E5%9C%A8%E6%9C%BA%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AAweb%E7%AB%99%E7%82%B9%EF%BC%8C%E4%BD%BF%E7%94%A8">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=WebSocket%2BTLS%2BWeb的组合怎么来的？这个组合意思是，在机器上部署一个web站点，使用</a> Nginx%2FCaddy%2FApache 可以将 V2Ray 稍作隐藏。使用,只能用 WebSocket，使用 TLS 是因为可以流量加密，看起来更像 HTTPS。也就是说，我们的机器看起来是个正常的网站，当访问特定的path，可以把流量转发给V2Ray。))。</li>
<li><strong>系统安全：</strong> 定期更新系统 (<code>apt update &amp;&amp; apt upgrade</code>) 以修补漏洞。只开启必要的服务端口，不在服务器上运行不必要的服务。可以考虑安装 Fail2Ban 来防护 SSH 爆破等。</li>
<li><strong>BBR 加速：</strong> 为提升跨境网络的稳定性和速度，可启用 TCP BBR 拥塞控制算法（属于内核级优化）。Oracle Ubuntu内核通常自带BBR，可通过 <code>sysctl</code> 开启。这不会直接影响是否被封锁，但能改善连接质量，特别是在高延迟链路下常有帮助。</li>
</ul>
<p>完成上述防火墙和安全设置后，我们的服务器环境已经相对安全且对GFW更不敏感了。接下来配置客户端以使用该节点。</p>
<h2 id="7-Windows-11-端-V2RayN-客户端配置教程"><a href="#7-Windows-11-端-V2RayN-客户端配置教程" class="headerlink" title="7. Windows 11 端 V2RayN 客户端配置教程"></a>7. Windows 11 端 V2RayN 客户端配置教程</h2><p>在 Windows 上推荐使用 <strong>V2RayN</strong> 图形客户端来连接刚刚搭建的 V2Ray 服务。下面是 Windows 11 下使用 V2RayN 的配置步骤：</p>
<p><strong>（1）下载并安装 V2RayN：</strong> 前往 V2RayN 项目仓库 (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E9%85%8D%E7%BD%AEWindows%E5%AE%A2%E6%88%B7%E7%AB%AF">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)下载安装包，或者在可信的软件站下载最新版。运行安装后，打开 V2RayN。初次运行可能会提示安装 V2Ray 内核，按提示操作以下载 V2Ray-core。</p>
<p><strong>（2）添加 VMess 服务器配置：</strong> 在 V2RayN 主界面，点击 <strong>“服务器”</strong> -&gt; <strong>“添加[Vmess]服务器”</strong> 来新增一个节点。弹出配置窗口后，根据我们之前服务端的设置填写相关参数：</p>
<p>(<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>) <em>V2RayN 添加 VMess 服务器示例配置窗口</em></p>
<ul>
<li><strong>别名：</strong> 为该节点起一个名称，随意填写（例如 “Oracle-CF节点”），方便识别。</li>
<li><strong>地址(address)：</strong> 填入您的域名 <strong>example.com</strong>（不要填写IP地址，因为我们走域名流量）。 (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%B8%8E%E6%9C%80%E5%BC%80%E5%A7%8B%E7%9A%84%E9%85%8D%E7%BD%AE%E7%9B%B8%E6%AF%94%EF%BC%8C%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%82%B9%E5%8F%98%E5%8C%96%EF%BC%9A">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)</li>
<li><strong>端口(port)：</strong> 填 <strong>443</strong>。因为客户端将通过443端口的 TLS 来访问 Cloudflare。 (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%B8%8E%E6%9C%80%E5%BC%80%E5%A7%8B%E7%9A%84%E9%85%8D%E7%BD%AE%E7%9B%B8%E6%AF%94%EF%BC%8C%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%82%B9%E5%8F%98%E5%8C%96%EF%BC%9A">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)</li>
<li><strong>用户ID(id)：</strong> 填入您在服务器 config.json 中配置的 UUID。 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text={">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text={</a> “id”%3A “faef4e76,0 %2F%2F 新版本不能设置为64)) 确保完全一致无误。</li>
<li><strong>额外ID(alterId)：</strong> 填 <strong>0</strong>（与服务端一致）。</li>
<li><strong>加密方式(security)：</strong> 选择 <strong>auto</strong> 或留空（VMess 默认即可，表示自适应，通常为 AEAD AES-128-GCM）。</li>
<li><strong>传输协议(network)：</strong> 选择 **WebSocket (ws)**。 (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%B8%8E%E6%9C%80%E5%BC%80%E5%A7%8B%E7%9A%84%E9%85%8D%E7%BD%AE%E7%9B%B8%E6%AF%94%EF%BC%8C%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%82%B9%E5%8F%98%E5%8C%96%EF%BC%9A">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)</li>
<li><strong>伪装类型(type)：</strong> 选择 <strong>none</strong> （不使用进一步的Mux多路复用或gRPC，在TLS下已足够）。</li>
<li><strong>伪装域名(host)：</strong> （可留空）如果使用了CDN，本字段可填写您的域名以作为 Host 字段。但由于我们已经在“地址”使用域名且开启TLS，这里可不填或与地址相同。</li>
<li><strong>路径(path)：</strong> 填入 <strong>&#x2F;ray</strong>（即我们配置的 WebSocket 路径）。不填错一个字符。 (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=,">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>) (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=,">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)</li>
<li><strong>传输层安全(tls)：</strong> 选择 <strong>tls</strong>（开启TLS加密）。这会让 V2RayN 在连接时使用 wss:&#x2F;&#x2F;example.com，即 TLS WebSocket。 (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=,%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8%E6%80%A7%EF%BC%9A%E4%B9%8B%E5%89%8D%E6%B2%A1%E6%9C%89%EF%BC%8C%E7%8E%B0%E5%9C%A8%E6%98%AFTLS">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)</li>
<li><strong>跳过证书验证(allowInsecure)：</strong> 选择 <strong>false</strong>（不跳过）。这样可以验证服务端证书有效性，防止中间人攻击。除非您有自签名证书需要跳过验证，否则保持false。</li>
</ul>
<p>填写完毕后点击 <strong>确定</strong> 保存节点配置。然后在V2RayN界面选中该节点，点击 <strong>“连接”</strong>（或右键菜单选择启用）。如果一切配置正确，V2RayN 会成功连接。您可以尝试打开浏览器访问被墙的网站（如 Google、YouTube）来测试梯子是否工作。若可以正常打开，则证明客户端已成功通过 Cloudflare 与您搭建的 V2Ray 服务通信！ (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%BF%AE%E6%94%B9v2ray%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>) (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)</p>
<blockquote>
<p><strong>故障排查：</strong></p>
<ul>
<li>若无法连接，首先检查客户端配置项是否有拼写错误，例如 UUID 是否一致，域名和路径是否正确匹配。</li>
<li>在保证配置正确的前提下，尝试编辑该节点，将“传输层安全性”改为不安全（allowInsecure&#x3D;true）后测试，排除是否因为本地没有系统信任Let’s Encrypt根证书导致验证失败。</li>
<li>确认 Cloudflare 仪表盘中该域名记录状态为 Proxied（小云朵为橙色），且 SSL 设置为 Full (Strict)。</li>
<li>检查服务器端：<code>sudo systemctl status v2ray</code> 看服务是否在运行；查看 <code>/var/log/nginx/error.log</code> 或 <code>/var/log/nginx/access.log</code> 中是否有报错。Cloudflare 的请求源IP可以在 access.log 中通过我们配置的 <code>$remote_addr</code> 查看 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=proxy_http_version">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=proxy_http_version</a> 1,For %24proxy_add_x_forwarded_for%3B))。</li>
</ul>
</blockquote>
<h2 id="8-进一步加强隐蔽性的方法"><a href="#8-进一步加强隐蔽性的方法" class="headerlink" title="8. 进一步加强隐蔽性的方法"></a>8. 进一步加强隐蔽性的方法</h2><p>经过以上配置，我们已经实现了 <strong>“Web 网站 + WebSocket + TLS + Cloudflare”</strong> 的组合伪装。此时流量表面上与普通的 Cloudflare CDN 网站无异，大大增加了在中国大陆长期稳定使用的可能性 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=WebSocket%2BTLS%2BWeb%E7%9A%84%E7%BB%84%E5%90%88%E6%80%8E%E4%B9%88%E6%9D%A5%E7%9A%84%EF%BC%9F%E8%BF%99%E4%B8%AA%E7%BB%84%E5%90%88%E6%84%8F%E6%80%9D%E6%98%AF%EF%BC%8C%E5%9C%A8%E6%9C%BA%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AAweb%E7%AB%99%E7%82%B9%EF%BC%8C%E4%BD%BF%E7%94%A8">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=WebSocket%2BTLS%2BWeb的组合怎么来的？这个组合意思是，在机器上部署一个web站点，使用</a> Nginx%2FCaddy%2FApache 可以将 V2Ray 稍作隐藏。使用,只能用 WebSocket，使用 TLS 是因为可以流量加密，看起来更像 HTTPS。也就是说，我们的机器看起来是个正常的网站，当访问特定的path，可以把流量转发给V2Ray。)) ([ssr&#x2F;ssr-advanced&#x2F;v2ray-ws-tls-web.md at master · fqfree&#x2F;ssr · GitHub](<a target="_blank" rel="noopener" href="https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=%E8%BF%99%E9%87%8C%E4%BB%8E%E5%9F%9F%E5%90%8D%E6%B3%A8%E5%86%8C%E5%95%86GoDaddy%E8%B4%AD%E4%B9%B0%E5%9F%9F%E5%90%8D%EF%BC%8C%E7%94%A8Cloudflare%E6%8F%90%E4%BE%9B%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E3%80%82GoDaddy%E6%9C%AC%E8%BA%AB%E4%B9%9F%E6%8F%90%E4%BE%9B%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E6%9C%8D%E5%8A%A1%EF%BC%8C%E8%BF%99%E9%87%8C%E7%94%A8Cloudflare%E6%98%AF%E4%B8%BA%E4%BA%86%E9%85%8D%E7%BD%AECDN%E6%96%B9%E4%BE%BF">https://github.com/fqfree/ssr/blob/master/ssr-advanced/v2ray-ws-tls-web.md#:~:text=这里从域名注册商GoDaddy购买域名，用Cloudflare提供域名解析。GoDaddy本身也提供域名解析服务，这里用Cloudflare是为了配置CDN方便</a> 。如果遇到墙加高，或者IP被墙等极端情况，只要简单的配置就可以切换成v2ray%2Bws%2Btls%2Bweb%2Bcdn。CDN翻墙速度较慢，但是稳定性极高。))。如果您仍希望进一步加强隐蔽和安全性，下面提供一些可选思路：</p>
<ul>
<li><strong>使用 Cloudflare Worker 作为中继：</strong> Cloudflare Worker 可以部署自定义脚本来处理请求。高级用户可以编写 Worker 脚本，将特定路径的 WebSocket 请求转发到您的源站（使用 <code>fetch</code> API）。这样，客户端可以通过 Worker 的专用子域访问，达到额外的中转和混淆效果。例如，有开源项目利用 Cloudflare Worker 部署 <strong>VLESS</strong> 代理，实现免费节点 ([【教程】通过Cloudflare Workers 部署V2ray 代理，实现科学上网](<a target="_blank" rel="noopener" href="https://blog.dongstop.link/edgetunnel#:~:text=%E6%95%99%E7%A8%8B">https://blog.dongstop.link/edgetunnel#:~:text=教程</a> 通过Cloudflare Workers 部署V2ray 代理，实现科学上网,项目，可以通过Cloudflare Workers 部署一个vless协议的V2ray代理。 提醒各位，本项目仅限技术交流使用，请勿滥用，由此引))。需要注意滥用可能违反 Cloudflare 使用政策，因此此方案仅供研究。</li>
<li><strong>利用 Cloudflare Page Rules&#x2F;CDN 设置：</strong> Cloudflare 提供 <strong>页面规则</strong> 和 <strong>Transform Rules</strong> 等高级功能。例如，您可以设置 Page Rule，对特定 URL 路径启用 <strong>Cache Everything</strong>（缓存所有内容）等，以减少源站流量暴露；或者设置浏览器缓存时间、开启 <strong>Rocket Loader</strong>、<strong>Brotli</strong> 压缩等优化来混淆流量模式 (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>) (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E7%84%B6%E5%90%8E%E5%9C%A8%E9%80%9F%E5%BA%A6">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)。这些对于流量隐蔽不是直接措施，但可以让您的站点看起来和其它普通站点别无二致（有正常的静态资源加载和优化）。</li>
<li><strong>启用 Cloudflare WAF 防火墙：</strong> 在 Cloudflare 面板的 <strong>安全</strong> 部分，可以启用 Web Application Firewall 对异常请求进行拦截。例如可以自定义规则，当非您客户端的IP大量访问 <code>/ray</code> 等路径时进行拦截，从而应对潜在的探测。Cloudflare 也有 <strong>Bot Fight Mode</strong> 可阻挡一些恶意爬虫扫描。</li>
<li><strong>定期更换 UUID 和路径：</strong> 为了万无一失，您可以定期更换 VMess UUID，客户端相应更新。从安全角度考虑，不同用户也应使用不同的 UUID。WebSocket 路径也可以不定期改变，但每次改变后需同步更新客户端。</li>
<li><strong>多节点容灾：</strong> 可考虑再准备不同运营商、不同地区的VPS节点，以及不同域名备用。一旦主节点被封锁域名或IP，可以迅速切换备用节点，减少服务中断。</li>
</ul>
<p>通过以上措施，您的代理流量将更加难以被识别，即使在 GFW 不断升级检测手段的情况下，也能最大限度地提高生存率。</p>
<hr>
<p><strong>总结：</strong>本教程从零开始在 Oracle 云 Ubuntu 实例上搭建了 V2Ray + WebSocket + TLS 的节点，并利用 Nginx 伪装站点、Cloudflare CDN 进行中转隐藏，实现了高隐蔽性和稳定性的科学上网方案 ([V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞](<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=WebSocket%2BTLS%2BWeb%E7%9A%84%E7%BB%84%E5%90%88%E6%80%8E%E4%B9%88%E6%9D%A5%E7%9A%84%EF%BC%9F%E8%BF%99%E4%B8%AA%E7%BB%84%E5%90%88%E6%84%8F%E6%80%9D%E6%98%AF%EF%BC%8C%E5%9C%A8%E6%9C%BA%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AAweb%E7%AB%99%E7%82%B9%EF%BC%8C%E4%BD%BF%E7%94%A8">https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=WebSocket%2BTLS%2BWeb的组合怎么来的？这个组合意思是，在机器上部署一个web站点，使用</a> Nginx%2FCaddy%2FApache 可以将 V2Ray 稍作隐藏。使用,只能用 WebSocket，使用 TLS 是因为可以流量加密，看起来更像 HTTPS。也就是说，我们的机器看起来是个正常的网站，当访问特定的path，可以把流量转发给V2Ray。)) (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=%E4%B8%80%E8%88%AC%E6%9D%A5%E8%AF%B4%EF%BC%8C%E8%A3%85%E5%A5%BDV2Ray%E4%B9%8B%E5%90%8E%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AFIP%E7%BB%8F%E5%B8%B8%E8%A2%AB%E5%B0%81%EF%BC%8C%E5%9B%BA%E6%9C%89%E6%AD%A4%E6%96%B9%E6%A1%88%E3%80%82">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)。我们详细配置了服务器环境、安全加固策略，并提供了 Windows 客户端的设置方法，希望即使是新手用户也能按照步骤顺利完成部署。按照本文指导配置完成后，一个正常的 HTTPS 网站正在对外提供服务，而翻墙流量则巧妙地混入其中，对观察者来说难辨真假。祝您部署顺利，安全畅游互联网！</p>
<p><strong>参考资料：</strong> V2Ray 官方指南、V2Fly 社区教程，以及相关技术博客 (<a target="_blank" rel="noopener" href="https://whuwangyong.github.io/2023-03-18-v2ray-websocket-tls-web-cloudflare-guide/#:~:text=Reference">V2Ray+WebSocket+TLS+Web+Cloudflare教程 - 武大路飞</a>)等。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/092692589717.html" rel="prev" title="计算机网络-自上而下 1.1-1.3">
      <i class="fa fa-chevron-left"></i> 计算机网络-自上而下 1.1-1.3
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Oracle-VPS-Ubuntu-V2RayN-%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B%EF%BC%88Cloudflare-TLS-WebSocket%EF%BC%89"><span class="nav-number">1.</span> <span class="nav-text">Oracle VPS (Ubuntu) V2RayN 节点部署教程（Cloudflare TLS+WebSocket）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Oracle-VPS-%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.1.</span> <span class="nav-text">1. Oracle VPS 基础环境设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Cloudflare-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%B8%8E-DNS-%E9%85%8D%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">2. Cloudflare 域名解析与 DNS 配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%AE%89%E8%A3%85-Nginx-%E5%B9%B6%E9%85%8D%E7%BD%AE%E7%BD%91%E7%AB%99%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="nav-number">1.3.</span> <span class="nav-text">3. 安装 Nginx 并配置网站虚拟主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%AE%89%E8%A3%85-V2Ray-%E5%B9%B6%E9%85%8D%E7%BD%AE-WebSocket-TLS-%E6%94%AF%E6%8C%81"><span class="nav-number">1.4.</span> <span class="nav-text">4. 安装 V2Ray 并配置 WebSocket + TLS 支持</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%94%B3%E8%AF%B7%E5%B9%B6%E9%85%8D%E7%BD%AE-TLS-%E8%AF%81%E4%B9%A6-Let%E2%80%99s-Encrypt"><span class="nav-number">1.5.</span> <span class="nav-text">5. 申请并配置 TLS 证书 (Let’s Encrypt)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E4%BC%98%E5%8C%96%E9%98%B2%E7%81%AB%E5%A2%99%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8"><span class="nav-number">1.6.</span> <span class="nav-text">6. 优化防火墙与服务器安全</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Windows-11-%E7%AB%AF-V2RayN-%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B"><span class="nav-number">1.7.</span> <span class="nav-text">7. Windows 11 端 V2RayN 客户端配置教程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%8A%A0%E5%BC%BA%E9%9A%90%E8%94%BD%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.8.</span> <span class="nav-text">8. 进一步加强隐蔽性的方法</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="GAIVR"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">GAIVR</p>
  <div class="site-description" itemprop="description">我在恐惧的释放着自信</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/GEORGE-Ta" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;GEORGE-Ta" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://benedictnghk.github.io/" title="https:&#x2F;&#x2F;benedictnghk.github.io&#x2F;" rel="noopener" target="_blank">Benedict Ng</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.wxiwnd.net/" title="https:&#x2F;&#x2F;blog.wxiwnd.net&#x2F;" rel="noopener" target="_blank">wxiwnd Blog</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://mustlug.org/" title="https:&#x2F;&#x2F;mustlug.org&#x2F;" rel="noopener" target="_blank">MustLug</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GAIVR</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">57k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">52 分钟</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<div class="footer-custom">
  <a href="https://evolution-host.com/" target="_blank">Hosted by Evolution Host</a>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 't8yl7Ex9alHlNlCxkpxG8pfh-gzGzoHsz',
      appKey     : 'S8SRjrQUaLkNAVDr3gJlpF5J',
      placeholder: "You can leave a message here!",
      avatar     : '',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
<script src="/live2d-widget/autoload.js"></script>